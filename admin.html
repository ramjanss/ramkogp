<script type="module">

import { db, auth } from './firebase-config.js';
import { signInWithEmailAndPassword, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, addDoc, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const loginSection = document.getElementById("loginSection");
const adminSection = document.getElementById("adminSection");

onAuthStateChanged(auth, (user) => {
  if (user) {
    loginSection.style.display = "none";
    adminSection.style.display = "block";
    loadNotices();
  } else {
    loginSection.style.display = "block";
    adminSection.style.display = "none";
  }
});

window.login = function() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  signInWithEmailAndPassword(auth, email, password)
    .catch(error => alert(error.message));
};

window.logout = function() {
  signOut(auth);
};

window.addNotice = async function() {
  const title = document.getElementById("title").value;

  await addDoc(collection(db, "notices"), {
    title: title,
    created: new Date()
  });

  document.getElementById("title").value = "";
  loadNotices();
};

async function loadNotices() {
  const querySnapshot = await getDocs(collection(db, "notices"));
  const list = document.getElementById("noticeList");
  list.innerHTML = "";

  querySnapshot.forEach((docSnap) => {
    const data = docSnap.data();
    list.innerHTML += `
      <div class="notice">
        ${data.title}
        <button onclick="deleteNotice('${docSnap.id}')">Delete</button>
      </div>
    `;
  });
}

window.deleteNotice = async function(id) {
  await deleteDoc(doc(db, "notices", id));
  loadNotices();
};

</script>
<body>

<div id="loginSection">
  <h2>Admin Login</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="adminSection" style="display:none;">
  <h2>Admin Dashboard</h2>
  <button onclick="logout()">Logout</button>

  <hr>

  <h3>Add Notice</h3>
  <input type="text" id="title" placeholder="Notice Title">
  <button onclick="addNotice()">Add Notice</button>

  <h3>All Notices</h3>
  <div id="noticeList"></div>
</div>
